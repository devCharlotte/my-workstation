<div class="todo-container">
    <h4>To Do List</h4>
    <ul class="todo-list" id="todo-list">
        <!-- Checklist items will be added here -->
    </ul>

    <div class="buttons" id="default-buttons">
        <div class="input-group">
            <input type="text" id="todo-input" class="todo-input" placeholder="Enter a new task">
            <button onclick="addTodo()">Add Task</button>
        </div>
        <button onclick="enterSortMode()">Custom Sort Mode</button>
        <button onclick="enterDeleteMode()">Delete Mode</button>
    </div>

    <!-- Delete mode buttons -->
    <div id="delete-mode-buttons" class="hidden">
        <button onclick="exitDeleteMode()">Exit Delete Mode</button>
        <button onclick="clearAllTodos()">Clear All</button>
    </div>

    <!-- Sort mode buttons -->
    <div id="sort-mode-buttons" class="hidden">
        <button onclick="exitSortMode()">Exit Sort Mode</button>
    </div>
</div>

<script>
    // ToDo list functionalities
    let isSortMode = false;
    let isDeleteMode = false;

    // LocalStorage to persist todos
    function saveTodos(todos) {
        localStorage.setItem('todos', JSON.stringify(todos));
    }

    function loadTodos() {
        const savedTodos = localStorage.getItem('todos');
        return savedTodos ? JSON.parse(savedTodos) : [];
    }

    // Add a new task to the list
    function addTodo() {
        const todoInput = document.getElementById('todo-input');
        const taskText = todoInput.value.trim();
        if (taskText === '') return;

        const todos = loadTodos();
        todos.push({ text: taskText, completed: false });
        saveTodos(todos);
        renderTodos();
        todoInput.value = '';
    }

    // Render the todo list
    function renderTodos() {
        const todoList = document.getElementById('todo-list');
        todoList.innerHTML = '';

        const todos = loadTodos();
        todos.forEach((todo, index) => {
            const li = document.createElement('li');
            li.innerHTML = `<input type="checkbox" ${todo.completed ? 'checked' : ''} onclick="toggleComplete(${index})"> 
                            ${todo.text}`;
            li.draggable = isSortMode;
            li.addEventListener('dragstart', function(event) {
                event.dataTransfer.setData('text/plain', index);
            });
            li.addEventListener('dragover', function(event) {
                event.preventDefault();
            });
            li.addEventListener('drop', function(event) {
                const fromIndex = event.dataTransfer.getData('text');
                const toIndex = index;
                moveTodoItem(fromIndex, toIndex);
            });
            if (todo.completed) {
                li.classList.add('completed');
            }
            todoList.appendChild(li);
        });
    }

    // Move todo item in the list
    function moveTodoItem(fromIndex, toIndex) {
        const todos = loadTodos();
        const movedItem = todos.splice(fromIndex, 1)[0];
        todos.splice(toIndex, 0, movedItem);
        saveTodos(todos);
        renderTodos();
    }

    // Toggle the completion status of a task
    function toggleComplete(index) {
        const todos = loadTodos();
        todos[index].completed = !todos[index].completed;
        saveTodos(todos);
        renderTodos();
    }

    // Clear all tasks
    function clearAllTodos() {
        localStorage.removeItem('todos');
        renderTodos();
    }

    // Enter sort mode
    function enterSortMode() {
        if (isDeleteMode) return;
        isSortMode = true;
        document.getElementById('sort-mode-buttons').classList.remove('hidden');
        document.getElementById('default-buttons').classList.add('hidden');
        renderTodos();
    }

    // Exit sort mode
    function exitSortMode() {
        isSortMode = false;
        document.getElementById('sort-mode-buttons').classList.add('hidden');
        document.getElementById('default-buttons').classList.remove('hidden');
        renderTodos();
    }

    // Enter delete mode
    function enterDeleteMode() {
        if (isSortMode) return;
        isDeleteMode = true;
        document.getElementById('delete-mode-buttons').classList.remove('hidden');
        document.getElementById('default-buttons').classList.add('hidden');
        renderDeleteMode();
    }

    // Exit delete mode
    function exitDeleteMode() {
        isDeleteMode = false;
        document.getElementById('delete-mode-buttons').classList.add('hidden');
        document.getElementById('default-buttons').classList.remove('hidden');
        renderTodos();
    }

    // Render delete mode (show delete buttons)
    function renderDeleteMode() {
        const todoList = document.getElementById('todo-list');
        todoList.innerHTML = '';

        const todos = loadTodos();
        todos.forEach((todo, index) => {
            const li = document.createElement('li');
            li.innerHTML = `${todo.text} <button onclick="deleteTodo(${index})">Delete</button>`;
            todoList.appendChild(li);
        });
    }

    // Delete a single task
    function deleteTodo(index) {
        const todos = loadTodos();
        todos.splice(index, 1);
        saveTodos(todos);
        renderDeleteMode();
    }

    // Load and render todos when the page is loaded
    window.onload = renderTodos;
</script>
